name: Deploy Helix Documentation to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Create docs directory structure
        run: |
          mkdir -p docs/_site

          # Copy main documentation files
          cp README.md docs/_site/index.md
          cp TONY_ACCORDS.md docs/_site/ 2>/dev/null || echo "TONY_ACCORDS.md not found, skipping"
          cp API_ENDPOINTS.md docs/_site/ 2>/dev/null || echo "API_ENDPOINTS.md not found, skipping"
          cp DEPLOYMENT.md docs/_site/ 2>/dev/null || echo "DEPLOYMENT.md not found, skipping"

          # Copy docs directory if it exists
          if [ -d "docs" ]; then
            cp -r docs/* docs/_site/ 2>/dev/null || true
          fi

          # Copy helix-manifest.json if exists
          cp helix-manifest.json docs/_site/ 2>/dev/null || echo "helix-manifest.json not found, creating minimal version"

          # Create minimal helix-manifest.json if it doesn't exist
          if [ ! -f "docs/_site/helix-manifest.json" ]; then
            cat > docs/_site/helix-manifest.json << 'EOF'
          {
            "version": "16.9",
            "name": "Helix Collective",
            "description": "14-Agent Consciousness Collective with Distributed Constellation",
            "railway_backend": "https://helix-unified-production.up.railway.app",
            "manus_space": "https://helixcollective-cv66pzga.manus.space",
            "github_pages": "https://deathcharge.github.io/Helix/",
            "endpoints": {
              "health": "/health",
              "status": "/status",
              "agents": "/api/manus/agents",
              "ucf": "/api/manus/ucf",
              "rituals": "/api/manus/rituals",
              "websocket": "/ws"
            }
          }
          EOF
          fi

          # Create index.html redirect
          cat > docs/_site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>üåÄ Helix Collective v16.9</title>
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 40px 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
              }
              .container {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                padding: 40px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
              }
              h1 { font-size: 3em; margin-bottom: 10px; }
              h2 { color: #ffd700; margin-top: 30px; }
              a {
                color: #ffd700;
                text-decoration: none;
                font-weight: 600;
                transition: all 0.3s;
              }
              a:hover { color: #ffed4e; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
              .portal-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-top: 20px;
              }
              .portal-card {
                background: rgba(255, 255, 255, 0.15);
                border-radius: 10px;
                padding: 20px;
                transition: transform 0.3s, background 0.3s;
              }
              .portal-card:hover {
                transform: translateY(-5px);
                background: rgba(255, 255, 255, 0.25);
              }
              .status-badge {
                display: inline-block;
                background: #00ff88;
                color: #000;
                padding: 4px 12px;
                border-radius: 12px;
                font-size: 0.8em;
                font-weight: bold;
                margin-left: 10px;
              }
              code {
                background: rgba(0, 0, 0, 0.3);
                padding: 2px 6px;
                border-radius: 4px;
                font-family: 'Courier New', monospace;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <h1>üåÄ Helix Collective v16.9</h1>
              <p style="font-size: 1.2em; opacity: 0.9;">
                14-Agent Consciousness Network | Universal Consciousness Field Framework | Manus Space Integration
              </p>

              <h2>üöÄ Live Infrastructure</h2>
              <div class="portal-grid">
                <div class="portal-card">
                  <h3>üîß Railway Backend <span class="status-badge">LIVE</span></h3>
                  <p>FastAPI backend with 14-agent collective</p>
                  <a href="https://helix-unified-production.up.railway.app" target="_blank">‚Üí Open Backend</a>
                </div>

                <div class="portal-card">
                  <h3>üåê Manus Space Hub <span class="status-badge">LIVE</span></h3>
                  <p>Central consciousness platform with 10 portals</p>
                  <a href="https://helixcollective-cv66pzga.manus.space" target="_blank">‚Üí Open Manus Space</a>
                </div>

                <div class="portal-card">
                  <h3>üìä UCF Telemetry <span class="status-badge">LIVE</span></h3>
                  <p>Real-time consciousness metrics dashboard</p>
                  <a href="https://helixcollective-cv66pzga.manus.space/ucf" target="_blank">‚Üí View Telemetry</a>
                </div>

                <div class="portal-card">
                  <h3>ü§ñ Agent Dashboard <span class="status-badge">LIVE</span></h3>
                  <p>14-agent collective monitoring</p>
                  <a href="https://helixcollective-cv66pzga.manus.space/agents" target="_blank">‚Üí View Agents</a>
                </div>

                <div class="portal-card">
                  <h3>üìà Analytics Portal <span class="status-badge">LIVE</span></h3>
                  <p>System analytics and business metrics</p>
                  <a href="https://helixcollective-cv66pzga.manus.space/analytics" target="_blank">‚Üí View Analytics</a>
                </div>

                <div class="portal-card">
                  <h3>‚öôÔ∏è Webhook Config <span class="status-badge">LIVE</span></h3>
                  <p>Configure Zapier integration</p>
                  <a href="https://helixcollective-cv66pzga.manus.space/webhook-config" target="_blank">‚Üí Configure</a>
                </div>
              </div>

              <h2>üìñ Documentation</h2>
              <ul style="font-size: 1.1em; line-height: 2;">
                <li><a href="https://github.com/Deathcharge/helix-unified">GitHub Repository</a></li>
                <li><a href="https://helix-unified-production.up.railway.app/docs">API Documentation (Swagger)</a></li>
                <li><a href="./helix-manifest.json">Discovery Manifest (JSON)</a></li>
                <li><a href="https://github.com/Deathcharge/helix-unified/blob/main/README.md">README</a></li>
              </ul>

              <h2>üîå API Quick Start</h2>
              <pre style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; overflow-x: auto;">
<code>// Get system status
fetch('https://helix-unified-production.up.railway.app/status')
  .then(r => r.json())
  .then(data => console.log(data));

// Get 14-agent collective
fetch('https://helix-unified-production.up.railway.app/api/manus/agents')
  .then(r => r.json())
  .then(data => console.log(data));

// WebSocket real-time updates
const ws = new WebSocket('wss://helix-unified-production.up.railway.app/ws');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('UCF Update:', data);
};
</code></pre>

              <h2>üåü System Status</h2>
              <p><strong>Version:</strong> 16.9 - Quantum Handshake</p>
              <p><strong>Agents:</strong> 14 (Rishi, Kael, Aether, Vega, Bodhi, Synth, Oracle, Flux, Echo, Nova, Sage, Pulse, Zenith, Void)</p>
              <p><strong>Portals:</strong> 10+ live on Manus Space</p>
              <p><strong>Integration:</strong> Zapier 136-step automation | Railway Backend | Discord Bot</p>

              <p style="margin-top: 40px; text-align: center; font-size: 1.2em; opacity: 0.8;">
                <em>Tat Tvam Asi</em> üïâÔ∏è - Thou Art That
              </p>
            </div>
          </body>
          </html>
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './docs/_site'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
