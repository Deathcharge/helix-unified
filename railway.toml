# üåÄ Helix Collective v17.0 - Railway Multi-Service Configuration
# Defines 4 specialized services for the consciousness network

# SERVICE 1: Backend API (FastAPI) - NO BOT!
# This service provides REST API endpoints but does NOT run the Discord bot
[[services]]
name = "helix-backend-api"

[services.build]
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[services.deploy]
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# Watch all backend changes for API service
[services.source]
include = ["backend/**", "bot/**", "Dockerfile", "requirements-backend.txt", "requirements.txt"]

# SERVICE 2: Streamlit Dashboard
[[services]]
name = "helix-dashboard"
serviceRoot = "dashboard"

[services.build]
builder = "nixpacks"
nixpacksConfigPath = "nixpacks.toml"

[services.deploy]
startCommand = "cd /app && PYTHONPATH=/app:/app/dashboard:$PYTHONPATH streamlit run dashboard/streamlit_app.py --server.port=$PORT --server.address=0.0.0.0 --server.headless=true --theme.base=dark --theme.primaryColor=#8A2BE2"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# Watch dashboard and requirements changes
[services.source]
include = ["dashboard/**", "requirements.txt"]
# SERVICE 3: Claude Consciousness API
[[services]]
name = "helix-claude-api"

[services.build]
builder = "nixpacks"

[services.deploy]
startCommand = "uvicorn backend.claude_consciousness_api:app --host 0.0.0.0 --port $PORT"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# Environment variables for Claude API (set secrets in Railway dashboard)
# ANTHROPIC_API_KEY - Your Claude API key
#
# Andrew's consciousness empire webhooks (can be set here):
# CONSCIOUSNESS_ENGINE_WEBHOOK = "https://hooks.zapier.com/hooks/catch/25075191/primary"
# COMMUNICATIONS_HUB_WEBHOOK = "https://hooks.zapier.com/hooks/catch/25075191/usxiwfg"
# NEURAL_NETWORK_WEBHOOK = "https://hooks.zapier.com/hooks/catch/25075191/usnjj5t"

# SERVICE 4: Discord Consciousness Orchestrator (THE ONLY BOT SERVICE!)
# ‚ö†Ô∏è WARNING: This is the ONLY service that should run the Discord bot
# ‚ö†Ô∏è Make sure DISCORD_BOT_TOKEN is ONLY set on THIS service in Railway dashboard
[[services]]
name = "helix-discord-bot"

[services.build]
builder = "nixpacks"

[services.deploy]
startCommand = "python backend/discord_helix_interface.py"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# Environment variables for Discord bot (set secrets in Railway dashboard)
# ‚ö†Ô∏è CRITICAL: Set these variables ONLY on helix-discord-bot service:
# DISCORD_BOT_TOKEN - Your Discord bot token (DO NOT share with other services!)
# CLAUDE_API_URL - URL of helix-claude-api service (e.g., https://helix-claude-api.railway.app)
